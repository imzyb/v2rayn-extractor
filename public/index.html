<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>V2RayN èŠ‚ç‚¹æå–å™¨</title>
    <link rel="icon" href="https://www.svgrepo.com/show/513474/rocket.svg">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366F1; --bg-grad: linear-gradient(135deg, #0F172A 0%, #1E1B4B 100%);
            --glass: rgba(30, 41, 59, 0.8); --border: rgba(255,255,255,0.1);
            --text-primary: #F8FAFC; --text-secondary: #94A3B8;
        }
        body {
            background: var(--bg-grad); min-height: 100vh; color: var(--text-primary);
            font-family: 'Inter', sans-serif; padding: 20px; display: flex; justify-content: center; align-items: center;
        }
        .main-box { width: 100%; max-width: 820px; }
        
        /* === å¡ç‰‡æ ·å¼ === */
        .glass-card {
            background: var(--glass); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border); border-radius: 24px; padding: 32px;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
        }

        /* === å¯¼èˆª Tab (æ ¸å¿ƒä¼˜åŒ–ç‚¹) === */
        .nav-pills-custom {
            background: rgba(0,0,0,0.3); padding: 6px; border-radius: 16px; border: 1px solid var(--border);
        }
        .nav-pills-custom .nav-link {
            color: var(--text-secondary); font-weight: 600; padding: 10px 15px; border-radius: 12px; transition: all 0.3s;
            white-space: nowrap; /* é˜²æ­¢æ–‡å­—æ¢è¡Œ */
        }
        .nav-pills-custom .nav-link.active {
            background: var(--primary); color: #fff; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }

        /* === è¾“å…¥æ¡† === */
        .input-box {
            background: rgba(15, 23, 42, 0.5); border: 1px solid var(--border); border-radius: 16px; padding: 4px;
            transition: all 0.3s;
        }
        .input-box:focus-within { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.25); }
        .form-control {
            background: transparent !important; border: none !important; color: var(--text-primary) !important;
            padding: 14px 18px; font-size: 16px;
        }
        .form-control:focus { box-shadow: none !important; }
        .form-control::placeholder { color: rgba(255,255,255,0.3); }
        input[type="file"] { padding: 12px !important; }
        input[type="file"]::file-selector-button {
            background: var(--primary); border: none; color: #fff; border-radius: 8px;
            padding: 6px 12px; margin-right: 12px; cursor: pointer;
        }

        /* === æŒ‰é’® === */
        .btn-main {
            background: linear-gradient(135deg, #6366F1, #4F46E5); border: none; padding: 16px;
            border-radius: 16px; color: #fff; font-weight: 700; font-size: 18px; width: 100%;
            transition: all 0.2s; position: relative; z-index: 5; cursor: pointer;
        }
        .btn-main:hover { transform: translateY(-2px); box-shadow: 0 10px 25px -5px rgba(99, 102, 241, 0.6); }
        .btn-main:active { transform: scale(0.98); }
        .btn-main:disabled { opacity: 0.7; cursor: not-allowed; }

        /* === ç§»åŠ¨ç«¯ä¸“å±ä¼˜åŒ– === */
        @media (max-width: 576px) {
            body { padding: 15px; align-items: flex-start; pt-5; }
            .main-box { margin-top: 20px; }
            .glass-card { padding: 24px 16px; /* å‡å°å¡ç‰‡å†…è¾¹è· */ }
            .display-6 { font-size: 2rem; /* å‡å°æ ‡é¢˜å­—å· */ }
            
            /* ç´§å‡‘å‹å¯¼èˆªæ  */
            .nav-pills-custom { padding: 4px; }
            .nav-pills-custom .nav-link {
                padding: 10px 4px; /* æå°çš„æ°´å¹³å†…è¾¹è· */
                font-size: 14px;
            }
            .nav-pills-custom .nav-link i {
                display: none; /* éšè—å›¾æ ‡ï¼Œåªæ˜¾ç¤ºæ–‡å­—ï¼ŒèŠ‚çœç©ºé—´ */
            }
            
            .form-control { font-size: 14px; padding: 12px 14px; }
            .btn-main { padding: 14px; font-size: 16px; }
        }

        /* ... å…¶ä»–é€šç”¨æ ·å¼ ... */
        .table-wrap { background: rgba(15, 23, 42, 0.5); border-radius: 18px; border: 1px solid var(--border); overflow: hidden; }
        .table { --bs-table-bg: transparent; --bs-table-color: var(--text-primary); --bs-table-hover-bg: rgba(99, 102, 241, 0.1); --bs-table-hover-color: var(--text-primary); margin: 0; }
        .table th { background: rgba(0,0,0,0.25); color: var(--text-secondary) !important; text-transform: uppercase; font-size: 0.85rem; padding: 16px; border-bottom: 1px solid var(--border); }
        .table td { padding: 16px; border-bottom: 1px solid rgba(255,255,255,0.06); vertical-align: middle; color: var(--text-primary); }
        .badge-custom { padding: 6px 10px; border-radius: 8px; font-size: 12px; font-weight: 800; letter-spacing: 0.5px; background: rgba(255,255,255,0.1); }
        .view-toggle { background: rgba(0,0,0,0.3); border-radius: 50rem; padding: 4px; border: 1px solid var(--border); display: inline-flex; }
        .view-toggle .btn-toggle { border: none; background: transparent; color: var(--text-secondary); padding: 6px 16px; border-radius: 50rem; font-size: 14px; font-weight: 600; transition: all 0.2s; }
        .view-toggle .btn-toggle.active { background: var(--primary); color: #fff; box-shadow: 0 2px 10px -3px rgba(99, 102, 241, 0.5); }
        .d-none { display: none !important; }
    </style>
</head>
<body>
    <div class="main-box">
        <div class="glass-card">
            <div class="text-center mb-4 mb-md-5">
                <h2 class="fw-bold display-6" style="background: linear-gradient(to right, #fff, #a5b4fc); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                    V2RayN èŠ‚ç‚¹æå–å™¨
                </h2>
                <p class="text-white-50">Pro Version</p>
            </div>

            <ul class="nav nav-pills nav-fill nav-pills-custom mb-4" id="myTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="url-tab" data-bs-toggle="pill" data-bs-target="#url-pane" type="button" role="tab">
                        <i class="fa-solid fa-link me-2"></i>è®¢é˜…é“¾æ¥
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="file-tab" data-bs-toggle="pill" data-bs-target="#file-pane" type="button" role="tab">
                        <i class="fa-solid fa-file-arrow-up me-2"></i>æ–‡ä»¶ä¸Šä¼ 
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="json-tab" data-bs-toggle="pill" data-bs-target="#json-pane" type="button" role="tab">
                        <i class="fa-solid fa-code me-2"></i>æ–‡æœ¬å†…å®¹
                    </button>
                </li>
            </ul>

            <div class="tab-content mb-4" id="myTabContent">
                <div class="tab-pane fade show active" id="url-pane" role="tabpanel">
                    <div class="input-box">
                        <input type="url" class="form-control" id="inp-url" placeholder="åœ¨æ­¤ç²˜è´´ http:// æˆ– https:// å¼€å¤´çš„é“¾æ¥">
                    </div>
                </div>
                <div class="tab-pane fade" id="file-pane" role="tabpanel">
                    <div class="input-box">
                        <input type="file" class="form-control" id="inp-file">
                    </div>
                </div>
                <div class="tab-pane fade" id="json-pane" role="tabpanel">
                    <div class="input-box">
                        <textarea class="form-control font-monospace" id="inp-json" rows="6" placeholder="åœ¨æ­¤ç²˜è´´é…ç½®å†…å®¹..."></textarea>
                    </div>
                </div>
            </div>

            <button id="btn-go" class="btn-main">
                <span id="txt-go"><i class="fa-solid fa-bolt me-2"></i>ç«‹å³æå–</span>
                <span id="load-go" class="d-none"><span class="spinner-border spinner-border-sm me-2"></span>å¤„ç†ä¸­...</span>
            </button>

            <div id="err-box" class="alert alert-danger d-none mt-4 border-0 p-3" style="background: rgba(239,68,68,0.2); color: #fca5a5; border-radius: 16px;">
                <i class="fa-solid fa-triangle-exclamation me-2"></i><span id="err-msg"></span>
            </div>

            <div id="res-box" class="d-none mt-5">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="mb-0 fw-bold">ğŸ‰ æå–æˆåŠŸ</h5>
                    <div class="view-toggle">
                        <button class="btn-toggle active" id="btn-view-table">
                            <i class="fa-solid fa-list-ul me-md-2"></i><span class="d-none d-md-inline">åˆ—è¡¨</span>
                        </button>
                        <button class="btn-toggle" id="btn-view-text">
                            <i class="fa-regular fa-file-lines me-md-2"></i><span class="d-none d-md-inline">æ–‡æœ¬</span>
                        </button>
                    </div>
                </div>

                <div id="tab-table" class="table-wrap">
                    <div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
                        <table class="table table-hover align-middle">
                            <thead class="sticky-top">
                                <tr>
                                    <th class="ps-4">åç§°</th>
                                    <th class="text-center">ç±»å‹</th>
                                    <th class="text-end pe-4">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="res-tbody"></tbody>
                        </table>
                    </div>
                </div>

                <div id="tab-text" class="d-none">
                    <div class="input-box">
                        <textarea id="res-text" class="form-control font-monospace small" rows="12" readonly onclick="this.select()"></textarea>
                    </div>
                </div>

                <button id="btn-copy" class="btn-main mt-4" style="background: linear-gradient(135deg, #10b981, #059669);">
                    <i class="fa-solid fa-copy me-2"></i>ä¸€é”®å¤åˆ¶å…¨éƒ¨
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const get = (id) => document.getElementById(id);

        // æäº¤é€»è¾‘
        get('btn-go').onclick = async () => {
            resetUI();
            const formData = new FormData();
            let type = 'url';
            if (get('file-tab').classList.contains('active')) type = 'file';
            if (get('json-tab').classList.contains('active')) type = 'json';
            formData.append('inputType', type);

            if (type === 'url') {
                const val = get('inp-url').value.trim();
                if (!val) return showError('è¯·è¾“å…¥è®¢é˜…é“¾æ¥');
                formData.append('url', val);
            } else if (type === 'file') {
                if (!get('inp-file').files.length) return showError('è¯·é€‰æ‹©æ–‡ä»¶');
                formData.append('file', get('inp-file').files[0]);
            } else {
                const val = get('inp-json').value.trim();
                if (!val) return showError('è¯·è¾“å…¥æ–‡æœ¬å†…å®¹');
                formData.append('json_input', val);
            }

            try {
                setLoading(true);
                const res = await fetch('/api/extract', { method: 'POST', body: formData });
                const data = await res.json().catch(() => ({}));
                if (!res.ok) throw new Error(data.error || `æœåŠ¡å™¨é”™è¯¯ (${res.status})`);
                showResult(data);
            } catch (e) {
                showError(e.message || 'æœªçŸ¥é”™è¯¯ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ');
            } finally {
                setLoading(false);
            }
        };

        // è§†å›¾åˆ‡æ¢
        get('btn-view-table').onclick = () => switchView(true);
        get('btn-view-text').onclick = () => switchView(false);
        function switchView(isTable) {
            get('tab-table').classList.toggle('d-none', !isTable);
            get('tab-text').classList.toggle('d-none', isTable);
            get('btn-view-table').classList.toggle('active', isTable);
            get('btn-view-text').classList.toggle('active', !isTable);
        }

        // è¾…åŠ©åŠŸèƒ½
        get('btn-copy').onclick = () => doCopy(get('res-text').value, get('btn-copy'));
        window.copyOne = (btn, text) => doCopy(decodeURIComponent(text), btn, true);
        function doCopy(text, btn, isSmall=false) {
            navigator.clipboard.writeText(text).then(() => {
                const old = btn.innerHTML;
                btn.innerHTML = isSmall ? '<i class="fa-solid fa-check text-success"></i>' : '<i class="fa-solid fa-check me-2"></i>å·²å¤åˆ¶!';
                setTimeout(() => btn.innerHTML = old, 2000);
            }).catch(() => alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶'));
        }
        function showResult(data) {
            get('res-box').classList.remove('d-none');
            get('res-text').value = data.all_links;
            get('res-tbody').innerHTML = (data.nodes||[]).map(n => `
                <tr>
                    <td class="ps-4 fw-bold text-truncate" style="max-width: 140px;" title="${n.info.name}">${n.info.name}</td>
                    <td class="text-center"><span class="badge-custom">${n.info.type}</span></td>
                    <td class="text-end pe-4">
                        <button class="btn btn-sm btn-outline-light" onclick="copyOne(this, '${encodeURIComponent(n.link)}')">
                            <i class="fa-regular fa-copy"></i>
                        </button>
                    </td>
                </tr>`).join('');
            get('res-box').scrollIntoView({ behavior: 'smooth' });
        }
        function setLoading(isLoading) {
            get('btn-go').disabled = isLoading;
            get('txt-go').classList.toggle('d-none', isLoading);
            get('load-go').classList.toggle('d-none', !isLoading);
        }
        function resetUI() {
            get('err-box').classList.add('d-none');
            get('res-box').classList.add('d-none');
        }
        function showError(msg) {
            get('err-msg').textContent = msg;
            get('err-box').classList.remove('d-none');
        }
    </script>
</body>
</html>
